<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Tergiplex TrafficLight</title>
    <style>
      .on { opacity: 1.0; }
      .off { opacity: 0.2; }
    </style>
    <script src="app/components/react/react.js"></script>
    <script src="app/components/react/react-dom.js"></script>
    <script src="app/components/babel/browser.min.js"></script>
    <script src="app/components/spark/dist/spark.min.js"></script>
  </head>

  <body>
    <h1>The Tergiplex TrafficLight</h1>

    <div id="trafficlight">
      <div id="red"></div>
      <div id="yellow"></div>
      <div id="green"></div>
    </div>

    <script type="text/babel">
      const colors = [ "red", "yellow", "green" ]

      const Light = React.createClass({
        handleClick() {
          pizza_zombie.callFunction('ledToggle', this.props.pin)
        },
        render() {
          return <button onClick={this.handleClick} className={this.props.on ? 'on' : 'off'}> { colors[this.props.pin] } </button>;
        }
      });
      var pizza_zombie = null;
      spark.login({accessToken: '7fcc04bfd1c4450eed1c1c91ec3e3ec09a3fa9c6'}, (err, body) => {
        spark.listDevices((err, devices) => {
          for (let device of devices) {
            if (device.name == 'pizza_zombie') {
              pizza_zombie = device
              pizza_zombie.callFunction('getStatus')
              pizza_zombie.subscribe('led', (data) => {
                const pin = parseInt(data.data)
                const on = data.name==`ledOn`
                ReactDOM.render(<Light on={on} pin={pin} />, document.getElementById(colors[pin]))
              })
            }
          }
        });
      });
    </script>
  </body>
</html>
